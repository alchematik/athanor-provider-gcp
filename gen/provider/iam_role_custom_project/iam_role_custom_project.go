// Code generated by athanor-go.
// DO NOT EDIT.

package iam_role_custom_project

import (
	"context"
	"fmt"
	sdk "github.com/alchematik/athanor-go/sdk/provider/value"
	"github.com/alchematik/athanor-provider-gcp/gen/provider/identifier"
)

type IamRoleCustomProject struct {
	Identifier identifier.IamRoleCustomProjectIdentifier
	Config     Config
	Attrs      Attrs
}

func (x IamRoleCustomProject) ToResourceValue() (sdk.Resource, error) {
	id := x.Identifier.ToValue()

	config := x.Config.ToValue()

	attrs := x.Attrs.ToValue()

	return sdk.Resource{
		Identifier: id,
		Config:     config,
		Attrs:      attrs,
	}, nil
}

type IamRoleCustomProjectGetter interface {
	GetIamRoleCustomProject(context.Context, identifier.IamRoleCustomProjectIdentifier) (IamRoleCustomProject, error)
}

type IamRoleCustomProjectCreator interface {
	CreateIamRoleCustomProject(context.Context, identifier.IamRoleCustomProjectIdentifier, Config) (IamRoleCustomProject, error)
}

type IamRoleCustomProjectUpdator interface {
	UpdateIamRoleCustomProject(context.Context, identifier.IamRoleCustomProjectIdentifier, Config, []sdk.UpdateMaskField) (IamRoleCustomProject, error)
}

type IamRoleCustomProjectDeleter interface {
	DeleteIamRoleCustomProject(context.Context, identifier.IamRoleCustomProjectIdentifier) error
}

type IamRoleCustomProjectHandler struct {
	IamRoleCustomProjectGetter  IamRoleCustomProjectGetter
	IamRoleCustomProjectCreator IamRoleCustomProjectCreator
	IamRoleCustomProjectUpdator IamRoleCustomProjectUpdator
	IamRoleCustomProjectDeleter IamRoleCustomProjectDeleter

	CloseFunc func() error
}

func (h *IamRoleCustomProjectHandler) GetResource(ctx context.Context, id sdk.Identifier) (sdk.Resource, error) {
	if h.IamRoleCustomProjectGetter == nil {
		return sdk.Resource{}, fmt.Errorf("unimplemented")
	}

	idVal, err := identifier.ParseIamRoleCustomProjectIdentifier(id)
	if err != nil {
		return sdk.Resource{}, err
	}

	r, err := h.IamRoleCustomProjectGetter.GetIamRoleCustomProject(ctx, idVal)
	if err != nil {
		return sdk.Resource{}, err
	}

	return r.ToResourceValue()
}

func (h *IamRoleCustomProjectHandler) CreateResource(ctx context.Context, id sdk.Identifier, config any) (sdk.Resource, error) {
	if h.IamRoleCustomProjectCreator == nil {
		return sdk.Resource{}, fmt.Errorf("unimplemented")
	}

	idVal, err := identifier.ParseIamRoleCustomProjectIdentifier(id)
	if err != nil {
		return sdk.Resource{}, err
	}

	configVal, err := ParseConfig(config)
	if err != nil {
		return sdk.Resource{}, err
	}

	r, err := h.IamRoleCustomProjectCreator.CreateIamRoleCustomProject(ctx, idVal, configVal)
	if err != nil {
		return sdk.Resource{}, err
	}

	return r.ToResourceValue()
}

func (h *IamRoleCustomProjectHandler) UpdateResource(ctx context.Context, id sdk.Identifier, config any, mask []sdk.UpdateMaskField) (sdk.Resource, error) {
	if h.IamRoleCustomProjectUpdator == nil {
		return sdk.Resource{}, fmt.Errorf("unimplemented")
	}

	idVal, err := identifier.ParseIamRoleCustomProjectIdentifier(id)
	if err != nil {
		return sdk.Resource{}, err
	}

	configVal, err := ParseConfig(config)
	if err != nil {
		return sdk.Resource{}, err
	}

	r, err := h.IamRoleCustomProjectUpdator.UpdateIamRoleCustomProject(ctx, idVal, configVal, mask)
	if err != nil {
		return sdk.Resource{}, err
	}

	return r.ToResourceValue()
}

func (h *IamRoleCustomProjectHandler) DeleteResource(ctx context.Context, id sdk.Identifier) error {
	if h.IamRoleCustomProjectDeleter == nil {
		return fmt.Errorf("unimplemented")
	}

	idVal, err := identifier.ParseIamRoleCustomProjectIdentifier(id)
	if err != nil {
		return err
	}

	return h.IamRoleCustomProjectDeleter.DeleteIamRoleCustomProject(ctx, idVal)
}

func (h *IamRoleCustomProjectHandler) Close() error {
	if h.CloseFunc != nil {
		return h.CloseFunc()
	}

	return nil
}

type Attrs struct {
	Deleted bool
	Etag    string
}

func (x Attrs) ToValue() any {
	return map[string]any{
		"deleted": sdk.ToType[any](x.Deleted),
		"etag":    sdk.ToType[any](x.Etag),
	}
}

func ParseAttrs(v any) (Attrs, error) {
	m, err := sdk.Map[any](v)
	if err != nil {
		return Attrs{}, fmt.Errorf("error parsing attrs: %v", err)
	}

	deleted, err := sdk.Bool(m["deleted"])
	if err != nil {
		return Attrs{}, fmt.Errorf("error parsing attrs for iam_role_custom_project: %v", err)
	}
	etag, err := sdk.String(m["etag"])
	if err != nil {
		return Attrs{}, fmt.Errorf("error parsing attrs for iam_role_custom_project: %v", err)
	}

	return Attrs{
		Deleted: deleted,
		Etag:    etag,
	}, nil
}

func ParseAttrsList(v any) ([]Attrs, error) {
	list, ok := v.([]any)
	if !ok {
		return nil, fmt.Errorf("invalid type for list: %T", v)
	}

	var vals []Attrs
	for _, val := range list {
		p, err := ParseAttrs(val)
		if err != nil {
			return nil, err
		}

		vals = append(vals, p)
	}

	return vals, nil
}

type Config struct {
	Description string
	Permissions []string
	Stage       string
	Title       string
}

func (x Config) ToValue() any {
	return map[string]any{
		"description": sdk.ToType[any](x.Description),
		"permissions": sdk.ToType[string](x.Permissions),
		"stage":       sdk.ToType[any](x.Stage),
		"title":       sdk.ToType[any](x.Title),
	}
}

func ParseConfig(v any) (Config, error) {
	m, err := sdk.Map[any](v)
	if err != nil {
		return Config{}, fmt.Errorf("error parsing config: %v", err)
	}

	description, err := sdk.String(m["description"])
	if err != nil {
		return Config{}, fmt.Errorf("error parsing config for iam_role_custom_project: %v", err)
	}
	permissions, err := sdk.List[string](m["permissions"])
	if err != nil {
		return Config{}, fmt.Errorf("error parsing config for iam_role_custom_project: %v", err)
	}
	stage, err := sdk.String(m["stage"])
	if err != nil {
		return Config{}, fmt.Errorf("error parsing config for iam_role_custom_project: %v", err)
	}
	title, err := sdk.String(m["title"])
	if err != nil {
		return Config{}, fmt.Errorf("error parsing config for iam_role_custom_project: %v", err)
	}

	return Config{
		Description: description,
		Permissions: permissions,
		Stage:       stage,
		Title:       title,
	}, nil
}

func ParseConfigList(v any) ([]Config, error) {
	list, ok := v.([]any)
	if !ok {
		return nil, fmt.Errorf("invalid type for list: %T", v)
	}

	var vals []Config
	for _, val := range list {
		p, err := ParseConfig(val)
		if err != nil {
			return nil, err
		}

		vals = append(vals, p)
	}

	return vals, nil
}
